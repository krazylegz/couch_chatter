<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <title>CouchChat</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="refresh" content="600,URL=/chatter/_design/chatter/index.html"/>
    <link href="<%= assets %>/style/reset.css" rel="stylesheet" type="text/css"/>
    <link href="<%= assets %>/style/grid.css" rel="stylesheet" type="text/css"/>
    <link href="<%= assets %>/style/type.css" rel="stylesheet"  type="text/css"/>
    <link href="<%= assets %>/style/gadgets.css" rel="stylesheet" type="text/css" media="screen, projection"/>
    <!--[if IE]><link  href="style/ie.css" type="text/css" rel="stylesheet"/><![endif]-->
    <style type="text/css">
      .main {width: 70%;}
      h1 {margin-top: 8px;}
      h4 {margin-top: 8px;}
      img {
        border: 1px solid black;
        vertical-align: middle;
        height: 40px;
        width: 40px;
      }
      #userbox img {
        margin-bottom: 0.3em;
      }
      #chatbox img {
        float: left;
      }
      .messagediv {
        padding: .5em;
        background: #EEEEEE;
        margin-bottom: .2em;
        padding-bottom: .9em;
      }
      .messagespan {
        padding-left: .5em; font-size: .8em;
      }
    </style>
  </head>

  <body>
    <div id="container" class="main" style="width: 80%;">
      <div class="dl20"><h1>CouchChat</h1></div>
      <div class="dr20" style="text-align: right">
      </div>
      <br class="clear"/>

      <form id="chatform" method="post" action="post.html">
        <p>
        <span class="b">Message:</span>
        <input type="text" id="message" name="message"/>
        <input type="submit" name="Post" value="Post"/>
        </p>
      </form>

      <div id="chatbox" class="dl55" style="width: 80%; border: solid 1px #999999; height: 40em; overflow: auto;"></div>
      <div id="userbox" class="dr15" style="width: 150px; vertical-align: top;"></div>
      <br class="clear"/>
    </div>

  </body>

  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js?1.3.2"></script>
  <script src="/_utils/script/jquery.couch.js?0.8.0"></script>
  <script src="/_utils/script/jquery.cookies.js"></script>
  <script src="<%= assets %>/jquery.scrollTo.js"></script>
  <script src="<%= assets %>/vendor/couchapp/jquery.couchapp.js"></script>
  <script type="text/javascript">
    $(document).ready(function(){
      $("div#chatbox").load("/chatter/_design/chatter/_view/getposts?descending=true&limit=2");
      //$("div#chatbox").load("/chatter/_design/getposts/_view/getposts?descending=true&endkey=%22" + new Date() + "%22", {time: new Date().getTime() });
      //$("div#userbox").load("users.php", {time: new Date().getTime() });
      /*
      $("#message").focus();
      $('input[type=submit]').click(function() {
        $("#message").focus();
      });
      */
    });

    var refreshId = setInterval(function() {
        $("div#chatbox").load("/chatter/_design/chatter/_view/getposts?descending=true&limit=2");
    }, 10000);

    var refreshId = setInterval(function() {
      //$("div#userbox").load("users.php", {time: new Date().getTime() });
    }, 30000);
    $.CouchApp(function(app) {
      var postForm = app.docForm("form#chatform", {
        fields : ["message", "author"],
        beforeSave : function(doc) {
          doc.author = 'Test User 1';
          doc.created_at = new Date();
        },
        success : function (response) {
          $("div#chatbox").load("/chatter/_design/chatter/_view/getposts?descending=true&limit=2");
        }
      });
    });
  </script>
</html>
